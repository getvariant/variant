<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol.lst-kix_r73b7zc4zkgc-7.start{counter-reset:lst-ctn-kix_r73b7zc4zkgc-7 0}.lst-kix_78p0s41mdsc0-7>li:before{content:"\0025cb  "}.lst-kix_78p0s41mdsc0-5>li:before{content:"\0025a0  "}.lst-kix_jtvl3eb1olwi-0>li:before{content:"\0025cf  "}.lst-kix_78p0s41mdsc0-4>li:before{content:"\0025cb  "}.lst-kix_78p0s41mdsc0-8>li:before{content:"\0025a0  "}.lst-kix_jtvl3eb1olwi-1>li:before{content:"\0025cb  "}.lst-kix_78p0s41mdsc0-3>li:before{content:"\0025cf  "}.lst-kix_jtvl3eb1olwi-3>li:before{content:"\0025cf  "}.lst-kix_jtvl3eb1olwi-2>li:before{content:"\0025a0  "}.lst-kix_78p0s41mdsc0-2>li:before{content:"\0025a0  "}.lst-kix_p479iv3dde4g-3>li:before{content:"\0025cf  "}.lst-kix_jtvl3eb1olwi-5>li:before{content:"\0025a0  "}.lst-kix_p479iv3dde4g-2>li:before{content:"\0025a0  "}.lst-kix_p479iv3dde4g-4>li:before{content:"\0025cb  "}.lst-kix_jtvl3eb1olwi-4>li:before{content:"\0025cb  "}.lst-kix_jtvl3eb1olwi-8>li:before{content:"\0025a0  "}ul.lst-kix_78p0s41mdsc0-7{list-style-type:none}ul.lst-kix_78p0s41mdsc0-8{list-style-type:none}.lst-kix_p479iv3dde4g-0>li:before{content:"\0025cf  "}.lst-kix_p479iv3dde4g-1>li:before{content:"\0025cb  "}.lst-kix_jtvl3eb1olwi-7>li:before{content:"\0025cb  "}.lst-kix_jtvl3eb1olwi-6>li:before{content:"\0025cf  "}.lst-kix_78p0s41mdsc0-6>li:before{content:"\0025cf  "}ul.lst-kix_jdla6jmpsjre-5{list-style-type:none}ul.lst-kix_jdla6jmpsjre-6{list-style-type:none}ul.lst-kix_jdla6jmpsjre-7{list-style-type:none}ul.lst-kix_jdla6jmpsjre-8{list-style-type:none}ul.lst-kix_jdla6jmpsjre-1{list-style-type:none}ul.lst-kix_jdla6jmpsjre-2{list-style-type:none}ul.lst-kix_jdla6jmpsjre-3{list-style-type:none}ol.lst-kix_r73b7zc4zkgc-1.start{counter-reset:lst-ctn-kix_r73b7zc4zkgc-1 0}ul.lst-kix_jdla6jmpsjre-4{list-style-type:none}.lst-kix_p479iv3dde4g-7>li:before{content:"\0025cb  "}ul.lst-kix_qvaidrs1a0z1-7{list-style-type:none}ul.lst-kix_qvaidrs1a0z1-6{list-style-type:none}.lst-kix_p479iv3dde4g-6>li:before{content:"\0025cf  "}ul.lst-kix_qvaidrs1a0z1-8{list-style-type:none}.lst-kix_p479iv3dde4g-5>li:before{content:"\0025a0  "}ul.lst-kix_qvaidrs1a0z1-3{list-style-type:none}ul.lst-kix_qvaidrs1a0z1-2{list-style-type:none}ul.lst-kix_qvaidrs1a0z1-5{list-style-type:none}ul.lst-kix_qvaidrs1a0z1-4{list-style-type:none}.lst-kix_z7g10cw8i077-8>li:before{content:"\0025a0  "}.lst-kix_z7g10cw8i077-5>li:before{content:"\0025a0  "}.lst-kix_p479iv3dde4g-8>li:before{content:"\0025a0  "}ul.lst-kix_jdla6jmpsjre-0{list-style-type:none}.lst-kix_z7g10cw8i077-6>li:before{content:"\0025cf  "}.lst-kix_z7g10cw8i077-7>li:before{content:"\0025cb  "}.lst-kix_r73b7zc4zkgc-0>li{counter-increment:lst-ctn-kix_r73b7zc4zkgc-0}.lst-kix_z7g10cw8i077-0>li:before{content:"\0025cf  "}.lst-kix_ms5rjb6ez0rl-0>li:before{content:"\0025cf  "}.lst-kix_z7g10cw8i077-1>li:before{content:"\0025cb  "}.lst-kix_r73b7zc4zkgc-2>li{counter-increment:lst-ctn-kix_r73b7zc4zkgc-2}.lst-kix_z7g10cw8i077-4>li:before{content:"\0025cb  "}.lst-kix_z7g10cw8i077-2>li:before{content:"\0025a0  "}ol.lst-kix_r73b7zc4zkgc-2.start{counter-reset:lst-ctn-kix_r73b7zc4zkgc-2 0}.lst-kix_z7g10cw8i077-3>li:before{content:"\0025cf  "}.lst-kix_ms5rjb6ez0rl-5>li:before{content:"\0025a0  "}.lst-kix_ms5rjb6ez0rl-3>li:before{content:"\0025cf  "}.lst-kix_ms5rjb6ez0rl-4>li:before{content:"\0025cb  "}.lst-kix_ms5rjb6ez0rl-1>li:before{content:"\0025cb  "}.lst-kix_ms5rjb6ez0rl-2>li:before{content:"\0025a0  "}ul.lst-kix_r3an3irmt9is-4{list-style-type:none}ul.lst-kix_r3an3irmt9is-3{list-style-type:none}ul.lst-kix_r3an3irmt9is-6{list-style-type:none}ul.lst-kix_r3an3irmt9is-5{list-style-type:none}ul.lst-kix_r3an3irmt9is-8{list-style-type:none}ul.lst-kix_r3an3irmt9is-7{list-style-type:none}.lst-kix_jdla6jmpsjre-0>li:before{content:"\0025cf  "}.lst-kix_ms5rjb6ez0rl-6>li:before{content:"\0025cf  "}.lst-kix_jdla6jmpsjre-1>li:before{content:"\0025cb  "}.lst-kix_jdla6jmpsjre-2>li:before{content:"\0025a0  "}ul.lst-kix_r3an3irmt9is-0{list-style-type:none}.lst-kix_ms5rjb6ez0rl-7>li:before{content:"\0025cb  "}.lst-kix_ms5rjb6ez0rl-8>li:before{content:"\0025a0  "}.lst-kix_jdla6jmpsjre-3>li:before{content:"\0025cf  "}ul.lst-kix_r3an3irmt9is-2{list-style-type:none}ul.lst-kix_r3an3irmt9is-1{list-style-type:none}.lst-kix_jdla6jmpsjre-5>li:before{content:"\0025a0  "}.lst-kix_jdla6jmpsjre-6>li:before{content:"\0025cf  "}.lst-kix_jdla6jmpsjre-4>li:before{content:"\0025cb  "}ul.lst-kix_b7ed74530dzt-8{list-style-type:none}ul.lst-kix_b7ed74530dzt-6{list-style-type:none}ul.lst-kix_b7ed74530dzt-7{list-style-type:none}ul.lst-kix_b7ed74530dzt-4{list-style-type:none}.lst-kix_wu1e0tf9ypzh-7>li:before{content:"\0025cb  "}ul.lst-kix_b7ed74530dzt-5{list-style-type:none}.lst-kix_jdla6jmpsjre-8>li:before{content:"\0025a0  "}.lst-kix_wu1e0tf9ypzh-0>li:before{content:"\0025cf  "}.lst-kix_b7ed74530dzt-6>li:before{content:"\0025cf  "}.lst-kix_r73b7zc4zkgc-5>li{counter-increment:lst-ctn-kix_r73b7zc4zkgc-5}.lst-kix_b7ed74530dzt-8>li:before{content:"\0025a0  "}.lst-kix_yq0yuxrm3del-7>li:before{content:"\0025cb  "}ul.lst-kix_ms5rjb6ez0rl-8{list-style-type:none}ul.lst-kix_lp1xa3kyhr0s-0{list-style-type:none}ul.lst-kix_ms5rjb6ez0rl-7{list-style-type:none}ol.lst-kix_r73b7zc4zkgc-8.start{counter-reset:lst-ctn-kix_r73b7zc4zkgc-8 0}.lst-kix_yq0yuxrm3del-5>li:before{content:"\0025a0  "}ul.lst-kix_lp1xa3kyhr0s-5{list-style-type:none}ul.lst-kix_lp1xa3kyhr0s-6{list-style-type:none}.lst-kix_yq0yuxrm3del-3>li:before{content:"\0025cf  "}ul.lst-kix_lp1xa3kyhr0s-7{list-style-type:none}ul.lst-kix_lp1xa3kyhr0s-8{list-style-type:none}ul.lst-kix_lp1xa3kyhr0s-1{list-style-type:none}ul.lst-kix_lp1xa3kyhr0s-2{list-style-type:none}ul.lst-kix_lp1xa3kyhr0s-3{list-style-type:none}ul.lst-kix_lp1xa3kyhr0s-4{list-style-type:none}.lst-kix_qcgr3vnppenh-0>li:before{content:"\0025cf  "}.lst-kix_lp1xa3kyhr0s-0>li:before{content:"\0025cf  "}.lst-kix_r73b7zc4zkgc-3>li{counter-increment:lst-ctn-kix_r73b7zc4zkgc-3}ol.lst-kix_r73b7zc4zkgc-5.start{counter-reset:lst-ctn-kix_r73b7zc4zkgc-5 0}.lst-kix_qcgr3vnppenh-2>li:before{content:"\0025a0  "}.lst-kix_qcgr3vnppenh-4>li:before{content:"\0025cb  "}.lst-kix_r73b7zc4zkgc-8>li:before{content:"" counter(lst-ctn-kix_r73b7zc4zkgc-8,lower-roman) ". "}.lst-kix_lp1xa3kyhr0s-4>li:before{content:"\0025cb  "}.lst-kix_lp1xa3kyhr0s-8>li:before{content:"\0025a0  "}.lst-kix_8iu1z1ahl4hi-3>li:before{content:"\0025cf  "}.lst-kix_8iu1z1ahl4hi-1>li:before{content:"\0025cb  "}.lst-kix_r73b7zc4zkgc-6>li:before{content:"" counter(lst-ctn-kix_r73b7zc4zkgc-6,decimal) ". "}.lst-kix_lp1xa3kyhr0s-2>li:before{content:"\0025a0  "}ul.lst-kix_8iu1z1ahl4hi-2{list-style-type:none}ul.lst-kix_8iu1z1ahl4hi-1{list-style-type:none}.lst-kix_8iu1z1ahl4hi-7>li:before{content:"\0025cb  "}ul.lst-kix_8iu1z1ahl4hi-4{list-style-type:none}ul.lst-kix_qvaidrs1a0z1-1{list-style-type:none}ul.lst-kix_8iu1z1ahl4hi-3{list-style-type:none}ul.lst-kix_qvaidrs1a0z1-0{list-style-type:none}ul.lst-kix_8iu1z1ahl4hi-0{list-style-type:none}ul.lst-kix_ms5rjb6ez0rl-2{list-style-type:none}ul.lst-kix_ms5rjb6ez0rl-1{list-style-type:none}ul.lst-kix_ms5rjb6ez0rl-0{list-style-type:none}ul.lst-kix_8iu1z1ahl4hi-6{list-style-type:none}ul.lst-kix_ms5rjb6ez0rl-6{list-style-type:none}.lst-kix_8iu1z1ahl4hi-5>li:before{content:"\0025a0  "}ul.lst-kix_8iu1z1ahl4hi-5{list-style-type:none}ul.lst-kix_ms5rjb6ez0rl-5{list-style-type:none}ul.lst-kix_8iu1z1ahl4hi-8{list-style-type:none}ul.lst-kix_ms5rjb6ez0rl-4{list-style-type:none}ul.lst-kix_8iu1z1ahl4hi-7{list-style-type:none}.lst-kix_lp1xa3kyhr0s-6>li:before{content:"\0025cf  "}ul.lst-kix_ms5rjb6ez0rl-3{list-style-type:none}ul.lst-kix_jtvl3eb1olwi-0{list-style-type:none}ol.lst-kix_r73b7zc4zkgc-3{list-style-type:none}ul.lst-kix_78p0s41mdsc0-5{list-style-type:none}ol.lst-kix_r73b7zc4zkgc-2{list-style-type:none}ul.lst-kix_78p0s41mdsc0-6{list-style-type:none}ol.lst-kix_r73b7zc4zkgc-5{list-style-type:none}ul.lst-kix_78p0s41mdsc0-3{list-style-type:none}ol.lst-kix_r73b7zc4zkgc-4{list-style-type:none}ol.lst-kix_r73b7zc4zkgc-6.start{counter-reset:lst-ctn-kix_r73b7zc4zkgc-6 0}ul.lst-kix_78p0s41mdsc0-4{list-style-type:none}ol.lst-kix_r73b7zc4zkgc-7{list-style-type:none}ul.lst-kix_78p0s41mdsc0-1{list-style-type:none}ol.lst-kix_r73b7zc4zkgc-6{list-style-type:none}ul.lst-kix_78p0s41mdsc0-2{list-style-type:none}.lst-kix_r73b7zc4zkgc-4>li{counter-increment:lst-ctn-kix_r73b7zc4zkgc-4}ol.lst-kix_r73b7zc4zkgc-8{list-style-type:none}ul.lst-kix_78p0s41mdsc0-0{list-style-type:none}.lst-kix_b7ed74530dzt-4>li:before{content:"\0025cb  "}.lst-kix_r73b7zc4zkgc-0>li:before{content:"" counter(lst-ctn-kix_r73b7zc4zkgc-0,decimal) ". "}ol.lst-kix_r73b7zc4zkgc-1{list-style-type:none}.lst-kix_r73b7zc4zkgc-4>li:before{content:"" counter(lst-ctn-kix_r73b7zc4zkgc-4,lower-latin) ". "}.lst-kix_78p0s41mdsc0-0>li:before{content:"\0025cf  "}ol.lst-kix_r73b7zc4zkgc-0{list-style-type:none}.lst-kix_b7ed74530dzt-2>li:before{content:"\0025a0  "}ul.lst-kix_jtvl3eb1olwi-4{list-style-type:none}ul.lst-kix_b7ed74530dzt-2{list-style-type:none}ul.lst-kix_jtvl3eb1olwi-3{list-style-type:none}ul.lst-kix_b7ed74530dzt-3{list-style-type:none}ul.lst-kix_jtvl3eb1olwi-2{list-style-type:none}ul.lst-kix_b7ed74530dzt-0{list-style-type:none}ul.lst-kix_jtvl3eb1olwi-1{list-style-type:none}ul.lst-kix_b7ed74530dzt-1{list-style-type:none}ul.lst-kix_jtvl3eb1olwi-8{list-style-type:none}ul.lst-kix_jtvl3eb1olwi-7{list-style-type:none}.lst-kix_r73b7zc4zkgc-2>li:before{content:"" counter(lst-ctn-kix_r73b7zc4zkgc-2,lower-roman) ". "}ul.lst-kix_jtvl3eb1olwi-6{list-style-type:none}ul.lst-kix_jtvl3eb1olwi-5{list-style-type:none}.lst-kix_b7ed74530dzt-0>li:before{content:"\0025cf  "}.lst-kix_r3an3irmt9is-2>li:before{content:"\0025a0  "}ul.lst-kix_p479iv3dde4g-7{list-style-type:none}ul.lst-kix_p479iv3dde4g-8{list-style-type:none}.lst-kix_r3an3irmt9is-1>li:before{content:"\0025cb  "}.lst-kix_r3an3irmt9is-3>li:before{content:"\0025cf  "}ul.lst-kix_p479iv3dde4g-5{list-style-type:none}ul.lst-kix_p479iv3dde4g-6{list-style-type:none}.lst-kix_r3an3irmt9is-0>li:before{content:"\0025cf  "}.lst-kix_r3an3irmt9is-4>li:before{content:"\0025cb  "}ul.lst-kix_p479iv3dde4g-3{list-style-type:none}ul.lst-kix_p479iv3dde4g-4{list-style-type:none}ul.lst-kix_p479iv3dde4g-1{list-style-type:none}ul.lst-kix_p479iv3dde4g-2{list-style-type:none}.lst-kix_r3an3irmt9is-6>li:before{content:"\0025cf  "}ul.lst-kix_p479iv3dde4g-0{list-style-type:none}.lst-kix_r3an3irmt9is-5>li:before{content:"\0025a0  "}.lst-kix_r3an3irmt9is-7>li:before{content:"\0025cb  "}ol.lst-kix_r73b7zc4zkgc-4.start{counter-reset:lst-ctn-kix_r73b7zc4zkgc-4 0}.lst-kix_r3an3irmt9is-8>li:before{content:"\0025a0  "}ul.lst-kix_z7g10cw8i077-7{list-style-type:none}.lst-kix_qvaidrs1a0z1-2>li:before{content:"\0025a0  "}ul.lst-kix_z7g10cw8i077-8{list-style-type:none}.lst-kix_qvaidrs1a0z1-0>li:before{content:"\0025cf  "}.lst-kix_qvaidrs1a0z1-4>li:before{content:"\0025cb  "}.lst-kix_qvaidrs1a0z1-3>li:before{content:"\0025cf  "}.lst-kix_qvaidrs1a0z1-6>li:before{content:"\0025cf  "}ul.lst-kix_z7g10cw8i077-0{list-style-type:none}ul.lst-kix_z7g10cw8i077-1{list-style-type:none}ul.lst-kix_z7g10cw8i077-2{list-style-type:none}ul.lst-kix_z7g10cw8i077-3{list-style-type:none}ul.lst-kix_z7g10cw8i077-4{list-style-type:none}ul.lst-kix_z7g10cw8i077-5{list-style-type:none}.lst-kix_qvaidrs1a0z1-5>li:before{content:"\0025a0  "}ul.lst-kix_z7g10cw8i077-6{list-style-type:none}.lst-kix_qvaidrs1a0z1-1>li:before{content:"\0025cb  "}.lst-kix_qcgr3vnppenh-6>li:before{content:"\0025cf  "}.lst-kix_qcgr3vnppenh-8>li:before{content:"\0025a0  "}.lst-kix_qcgr3vnppenh-5>li:before{content:"\0025a0  "}.lst-kix_qcgr3vnppenh-7>li:before{content:"\0025cb  "}ul.lst-kix_qcgr3vnppenh-8{list-style-type:none}.lst-kix_qvaidrs1a0z1-8>li:before{content:"\0025a0  "}.lst-kix_yq0yuxrm3del-1>li:before{content:"\0025cb  "}.lst-kix_qvaidrs1a0z1-7>li:before{content:"\0025cb  "}ul.lst-kix_qcgr3vnppenh-4{list-style-type:none}ul.lst-kix_qcgr3vnppenh-5{list-style-type:none}ul.lst-kix_qcgr3vnppenh-6{list-style-type:none}ul.lst-kix_qcgr3vnppenh-7{list-style-type:none}ul.lst-kix_qcgr3vnppenh-0{list-style-type:none}ul.lst-kix_qcgr3vnppenh-1{list-style-type:none}.lst-kix_yq0yuxrm3del-0>li:before{content:"\0025cf  "}.lst-kix_r73b7zc4zkgc-8>li{counter-increment:lst-ctn-kix_r73b7zc4zkgc-8}ul.lst-kix_qcgr3vnppenh-2{list-style-type:none}ul.lst-kix_qcgr3vnppenh-3{list-style-type:none}.lst-kix_wu1e0tf9ypzh-2>li:before{content:"\0025a0  "}ol.lst-kix_r73b7zc4zkgc-3.start{counter-reset:lst-ctn-kix_r73b7zc4zkgc-3 0}.lst-kix_wu1e0tf9ypzh-3>li:before{content:"\0025cf  "}.lst-kix_wu1e0tf9ypzh-4>li:before{content:"\0025cb  "}.lst-kix_wu1e0tf9ypzh-6>li:before{content:"\0025cf  "}.lst-kix_wu1e0tf9ypzh-5>li:before{content:"\0025a0  "}.lst-kix_wu1e0tf9ypzh-8>li:before{content:"\0025a0  "}.lst-kix_jdla6jmpsjre-7>li:before{content:"\0025cb  "}.lst-kix_wu1e0tf9ypzh-1>li:before{content:"\0025cb  "}.lst-kix_b7ed74530dzt-5>li:before{content:"\0025a0  "}.lst-kix_b7ed74530dzt-7>li:before{content:"\0025cb  "}ul.lst-kix_yq0yuxrm3del-5{list-style-type:none}ul.lst-kix_yq0yuxrm3del-4{list-style-type:none}.lst-kix_yq0yuxrm3del-6>li:before{content:"\0025cf  "}ul.lst-kix_wu1e0tf9ypzh-7{list-style-type:none}ul.lst-kix_yq0yuxrm3del-3{list-style-type:none}ul.lst-kix_wu1e0tf9ypzh-8{list-style-type:none}ul.lst-kix_yq0yuxrm3del-2{list-style-type:none}ul.lst-kix_wu1e0tf9ypzh-5{list-style-type:none}ul.lst-kix_wu1e0tf9ypzh-6{list-style-type:none}ul.lst-kix_yq0yuxrm3del-8{list-style-type:none}.lst-kix_r73b7zc4zkgc-6>li{counter-increment:lst-ctn-kix_r73b7zc4zkgc-6}ul.lst-kix_wu1e0tf9ypzh-3{list-style-type:none}ul.lst-kix_yq0yuxrm3del-7{list-style-type:none}ul.lst-kix_wu1e0tf9ypzh-4{list-style-type:none}ul.lst-kix_yq0yuxrm3del-6{list-style-type:none}.lst-kix_yq0yuxrm3del-2>li:before{content:"\0025a0  "}ul.lst-kix_yq0yuxrm3del-1{list-style-type:none}ul.lst-kix_yq0yuxrm3del-0{list-style-type:none}.lst-kix_yq0yuxrm3del-4>li:before{content:"\0025cb  "}.lst-kix_qcgr3vnppenh-1>li:before{content:"\0025cb  "}ul.lst-kix_wu1e0tf9ypzh-1{list-style-type:none}ul.lst-kix_wu1e0tf9ypzh-2{list-style-type:none}ul.lst-kix_wu1e0tf9ypzh-0{list-style-type:none}.lst-kix_yq0yuxrm3del-8>li:before{content:"\0025a0  "}.lst-kix_qcgr3vnppenh-3>li:before{content:"\0025cf  "}.lst-kix_8iu1z1ahl4hi-0>li:before{content:"\0025cf  "}.lst-kix_lp1xa3kyhr0s-3>li:before{content:"\0025cf  "}.lst-kix_lp1xa3kyhr0s-5>li:before{content:"\0025a0  "}.lst-kix_r73b7zc4zkgc-7>li:before{content:"" counter(lst-ctn-kix_r73b7zc4zkgc-7,lower-latin) ". "}.lst-kix_r73b7zc4zkgc-5>li:before{content:"" counter(lst-ctn-kix_r73b7zc4zkgc-5,lower-roman) ". "}.lst-kix_lp1xa3kyhr0s-1>li:before{content:"\0025cb  "}.lst-kix_8iu1z1ahl4hi-2>li:before{content:"\0025a0  "}.lst-kix_8iu1z1ahl4hi-8>li:before{content:"\0025a0  "}.lst-kix_r73b7zc4zkgc-1>li{counter-increment:lst-ctn-kix_r73b7zc4zkgc-1}.lst-kix_8iu1z1ahl4hi-4>li:before{content:"\0025cb  "}.lst-kix_lp1xa3kyhr0s-7>li:before{content:"\0025cb  "}.lst-kix_8iu1z1ahl4hi-6>li:before{content:"\0025cf  "}.lst-kix_b7ed74530dzt-3>li:before{content:"\0025cf  "}.lst-kix_r73b7zc4zkgc-1>li:before{content:"" counter(lst-ctn-kix_r73b7zc4zkgc-1,lower-latin) ". "}.lst-kix_r73b7zc4zkgc-7>li{counter-increment:lst-ctn-kix_r73b7zc4zkgc-7}.lst-kix_r73b7zc4zkgc-3>li:before{content:"" counter(lst-ctn-kix_r73b7zc4zkgc-3,decimal) ". "}.lst-kix_78p0s41mdsc0-1>li:before{content:"\0025cb  "}.lst-kix_b7ed74530dzt-1>li:before{content:"\0025cb  "}ol.lst-kix_r73b7zc4zkgc-0.start{counter-reset:lst-ctn-kix_r73b7zc4zkgc-0 0}ol{margin:0;padding:0}.c13{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#f3f3f3;border-top-width:1pt;border-right-width:1pt;border-left-color:#f3f3f3;vertical-align:top;border-right-color:#f3f3f3;border-left-width:1pt;border-top-style:solid;background-color:#fdfdfe;border-left-style:solid;border-bottom-width:1pt;width:171pt;border-top-color:#f3f3f3;border-bottom-style:solid}.c16{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#f3f3f3;border-top-width:1pt;border-right-width:1pt;border-left-color:#f3f3f3;vertical-align:top;border-right-color:#f3f3f3;border-left-width:1pt;border-top-style:solid;background-color:#fdfdfe;border-left-style:solid;border-bottom-width:1pt;width:467.2pt;border-top-color:#f3f3f3;border-bottom-style:solid}.c8{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#f3f3f3;border-top-width:1pt;border-right-width:1pt;border-left-color:#f3f3f3;vertical-align:top;border-right-color:#f3f3f3;border-left-width:1pt;border-top-style:solid;background-color:#fdfdfe;border-left-style:solid;border-bottom-width:1pt;width:142.5pt;border-top-color:#f3f3f3;border-bottom-style:solid}.c11{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#f3f3f3;border-top-width:1pt;border-right-width:1pt;border-left-color:#f3f3f3;vertical-align:top;border-right-color:#f3f3f3;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:296.2pt;border-top-color:#f3f3f3;border-bottom-style:solid}.c20{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#f3f3f3;border-top-width:1pt;border-right-width:1pt;border-left-color:#f3f3f3;vertical-align:top;border-right-color:#f3f3f3;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:142.5pt;border-top-color:#f3f3f3;border-bottom-style:solid}.c21{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#f3f3f3;border-top-width:1pt;border-right-width:1pt;border-left-color:#f3f3f3;vertical-align:top;border-right-color:#f3f3f3;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:456pt;border-top-color:#f3f3f3;border-bottom-style:solid}.c9{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#f3f3f3;border-top-width:1pt;border-right-width:1pt;border-left-color:#f3f3f3;vertical-align:top;border-right-color:#f3f3f3;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:186.8pt;border-top-color:#f3f3f3;border-bottom-style:solid}.c17{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#f3f3f3;border-top-width:1pt;border-right-width:1pt;border-left-color:#f3f3f3;vertical-align:top;border-right-color:#f3f3f3;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:171pt;border-top-color:#f3f3f3;border-bottom-style:solid}.c12{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#f3f3f3;border-top-width:1pt;border-right-width:1pt;border-left-color:#f3f3f3;vertical-align:top;border-right-color:#f3f3f3;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:126.8pt;border-top-color:#f3f3f3;border-bottom-style:solid}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left;direction:ltr}.c1{color:#000000;font-weight:normal;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c19{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c3{orphans:2;widows:2;direction:ltr}.c6{border-collapse:collapse;margin-right:auto}.c4{color:inherit;text-decoration:inherit}.c2{padding:0;margin:0}.c14{color:#1155cc;text-decoration:underline}.c15{margin-left:36pt;padding-left:0pt}.c5{height:11pt}.c7{height:0pt}.c10{page-break-after:avoid}.c18{background-color:#fdfdfe}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c19"><p class="c3"><span>Variant RCE Container &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c3"><span>User Guide</span></p><p class="c3"><span>Version 0.5 Beta, September 2015</span></p><h1 class="c3 c10"><a name="h.38gbqm71tr04"></a><span>1. Introduction</span></h1><h2 class="c3 c10"><a name="h.fa1xb2d388ko"></a><span>1.1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;About Variant</span></h2><p class="c3"><span>Variant RCE Container enables instrumentation of programmatic randomized controlled experiments (RCEs). The need for such experiments frequently arises in interactive applications where it is desirable to measure business impact of a change to user experience. A typical example is an eCommerce Web application: a change, even a bad one, to an FAQ page is not likely impact company&rsquo;s sales, but a change to the check-out experience is likely to have a direct impact.</span></p><p class="c3"><span>Variant Experience Container enables application programmers to validate any change to the application by running the new experience in parallel with the existing one as a randomized control experiment. User traffic is split randomly (but not necessarily equally) between the two experiences, and performance data is collected for comparing their relative effectiveness with respect to some business metric, e.g. sales. The experiment is run for as long as it takes for the measurements to reach statistical significance &mdash; a mathematical term meaning that enough traffic has passed through the experience that the any observed difference is not likely due to random variance.</span></p><p class="c3"><span>Variant can instrument any application change, no matter how complex and what components of the target application it affects. This gives application programmers the unique ability to control-test any material change to the application before publishing it to the world.</span></p><p class="c3 c5"><span></span></p><h2 class="c3 c10"><a name="h.6l5kpmk1bd2r"></a><span>1.2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A/B Testing Is Dead, Long Live A/B Testing</span></h2><p class="c3"><span>This is the right time to remark that you wouldn&rsquo;t be wrong to think of Variant as an advance A/B Testing platform for grownups. But we think that that distinction still doesn&rsquo;t capture Variant&rsquo;s true advancement: the ability to instrument&mdash;and the intention to test&mdash;every material change to the application.</span></p><p class="c3"><span>The reasons businesses introduce changes to critical user experiences fall into one of three categories:</span></p><ul class="c2 lst-kix_jtvl3eb1olwi-0 start"><li class="c3 c15"><span>Product driven changes:</span></li></ul><p class="c3"><span>Changes due to the natural evolution of the application: medium-to-large scale, planned incremental improvements to the existing experience, like introduction of wish lists or integration with a 3rd party extended warranty provider. These changes span the entire application stack and take weeks to months to implement.</span></p><ul class="c2 lst-kix_qcgr3vnppenh-0 start"><li class="c3 c15"><span>Marketing driven changes:</span></li></ul><p class="c3"><span>Smaller scale, &nbsp;changes like a button&rsquo;s color or label&mdash;what&rsquo;s typically is referred to as optimization. &nbsp;These changes are small in scale and typically only affect the HTML tier.</span></p><ul class="c2 lst-kix_lp1xa3kyhr0s-0 start"><li class="c3 c15"><span>Legal driven changes:</span></li></ul><p class="c3"><span>Changes due to new regulatory requirements or to address a potential legal exposure. These may vary widely in complexity, e.g. adding a new acknowledgement checkbox, or management of email notification preferences.</span></p><p class="c3"><span>Traditional A/B testing tools are strictly optimizational &mdash; they use the browser-side variance injection technique and can only address top 10% of the technology stack of a typical Web application. This is typically good enough to address most marketing driven optimizational changes, but does nothing to help control-test a broader change.</span></p><p class="c3"><span>Variant makes no assumptions about technology footprint of the change, offering application programmers the unique ability to control-test any material change to the application before deploying it to all users. The term A/B testing may still apply, but at Variant we prefer Application Change Verification.</span></p><h2 class="c3 c10"><a name="h.e0ip6w74rqe1"></a><span>1.3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Key Features</span></h2><h3 class="c3 c10"><a name="h.qxmiht6xmg54"></a><span>1.3.1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Variant Experiment Description Model (XDM)</span></h3><p class="c3"><span>Variant can do all the great things that it does thanks to its groundbreaking Experiment Definition Model (XDM) that allows the experiment designer to define the experiment as an abstract concept, and without worrying about implementation details.</span></p><p class="c3"><span>XDM operates on two entities: states and tests. States represent application states, e.g. pints in its execution path where it pauses and waits for user input. In a Web application, states correspond to pages. To XDM, state is a completely opaque notion: all that XDM knows about it is its name and that it may contain properties, whose meanings are opaque to the XDM.</span></p><p class="c3"><span>Tests are experiments instrumented over these states. Variant thinks of an experiment as a bag of states&mdash;the user traverses states one at a time, but there are no predefined connections between states. As opposed to states, tests are actualized and managed by Variant. A test must have at least two experiences: control&mdash;the one presumably mapped to the current code path,&mdash;and at least one variant experience that represents the new code path under test. Tests also declare on what states they are instrumented as well as relationships with other tests.</span></p><p class="c3"><span>The test designer captures an instance of XDM in a test schema document, like the one in</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1B0Amlpqys9u7atVhKjCj29_U5m49gGauNJijjFZXUIc/edit%23heading%3Dh.tcl6zsrnf7oo&amp;sa=D&amp;usg=AFQjCNEKQQRJd3PWRsQuLxTw_GILeW-3lw">&nbsp;Listing 2.1.1.</a></span></p><h3 class="c3 c10"><a name="h.qojzmseo592r"></a><span>1.3.2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Separation Between Experience Implementation and Experiment Instrumentation</span></h3><p class="c3"><span>To create a Variant experiment, the application programmer needs to accomplish two tasks: 1) write code that implements the new experiment; and 2) instrument this new code to run in parallel with the existing code as a randomized controlled experiment (RCE). With Variant, these tasks are entirely independent: the application code need not be concerned with the details of the experiment instrumentation, while Variant makes no assumptions about the application under test.</span></p><h3 class="c3 c10"><a name="h.q94sjgs4lab9"></a><span>1.3.3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Full Stack Instrumentation</span></h3><p class="c3"><span>It does not matter to Variant how simple or complex the change under experiment is because it supports the entire application stack with several integration modes available.</span></p><h3 class="c3 c10"><a name="h.da4rrhozodgq"></a><span>1.3.4. Platform Neutrality</span></h3><p class="c3"><span>Variant&rsquo;s pioneering Experiment Description Model (XDM) makes no assumption about the technology makeup of the application under test. The only assumption is that it is an interactive application that responds to real time user input, like a Web application or a telephony application. This makes Variant ideal for experiments that run on heterogeneous technology stacks, e.g. an experiment may span a Web application and a native mobile app.</span></p><h3 class="c3 c10"><a name="h.tdakv4iab9jc"></a><span>1.3.5.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Compile Time and Run Time Integration Modes</span></h3><p class="c3"><span>Variant can be integrated with in two ways: at compile time or at run time. Compile time in-process integration is more powerful but less flexible. It is capable not only of experience targeting and event logging, but also of traffic routing. Its shortcoming is that it must be available for your application&rsquo;s programming environment. (Java only at this time, Python under development.)</span></p><p class="c3"><span>Run time integration is via Variant&rsquo;s RESTful API Service. This integration mode does not depend on the application&rsquo;s programming environment, but is also less capable because Variant is running as a remote process and is unable to invoke methods in the application&rsquo;s address space.</span></p><h3 class="c3 c10"><a name="h.t3et5jdueoe0"></a><span>1.3.6. Full Support For Concurrent Experiments</span></h3><p class="c3"><span>If two tests have states in common, they are called concurrent. One of advances offered by Variant XDM is the ability to completely define concurrent tests. Test designer has the flexibility to either let Variant chose a disjoint default or define the entire variance space across all concurrent experiments. We call this disjoint and covariant test concurrency. &nbsp;For more, see</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1B0Amlpqys9u7atVhKjCj29_U5m49gGauNJijjFZXUIc/edit%23heading%3Dh.yw35fvkwhsfa&amp;sa=D&amp;usg=AFQjCNHHm7eHFQaWLKoDEN_wvE1NPXJNYw">&nbsp;Section 3.3.1. Concurrent Tests</a></span><span>.</span></p><h3 class="c3 c10"><a name="h.xoadpydermv6"></a><span>1.3.7.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Application Change Verification</span></h3><p class="c3"><span>Variant&rsquo;s principal advantage is that it can instrument any change, regardless of its complexity. This capability presents a new powerful paradigm: developers can&mdash;and should&mdash;treat every change to the application that has the potential of affecting a key business metric, as a proposition that requires verification. Every material change should be first implemented as a Variant RCE, tested and either accepted or rejected based on hard numbers, not gut feelings. We call this process Application Change Verification.</span></p><h1 class="c3 c10"><a name="h.f9v6ws81c4aw"></a><span>2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Architecture</span></h1><h2 class="c3 c10"><a name="h.5jkdh4a42ym0"></a><span>2.1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Life Cycle Of an Experiment</span></h2><p class="c3"><span>A Variant experiment has three distinct phases: design, execution and analysis. &nbsp;During design, the test designer creates the test schema, which contains definitions of all tests to be run on the application. Experiments then are executed along with the application, and, as they run, Variant records experiment data in a data store. These event records become the basis for the analysis and, ultimately, the decision of whether to accept or reject the new experience.</span></p><h3 class="c3 c10"><a name="h.xm1em1p9c9zz"></a><span>2.1.1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Experiment Design</span></h3><p class="c3"><span>One of Variant&rsquo;s key features is that it cleanly separates experience implementation from experiment instrumentation. The application programmer must create the code for the new experience (without overriding the existing experience!), but how exactly he does it is entirely up to him: experiment designer can do his work independently. Test instrumentation is a self-contained task and its outcome is the test schema, like one below, borrowed from the Pet Clinic sample application.</span></p><a href="#" name="657a30cad647f3ae4507058edc485c973d455a21"></a><a href="#" name="0"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c16" colspan="1" rowspan="1"><p class="c0"><span class="c1">{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp;&#39;states&#39;:[ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;{ &nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;&#39;name&#39;:&#39;newOwner&#39;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;&#39;parameters&#39;: {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;&#39;path&#39;:&#39;/petclinic/owners/new&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;}, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;{</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;&#39;name&#39;:&#39;ownerDetail&#39;, &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;&#39;parameters&#39;: {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;&#39;path&#39;:&#39;/petclinic/owners/~\\d+/&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp;], &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp;&#39;tests&#39;:[ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;&#39;name&#39;:&#39;NewOwnerTest&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;&#39;isOn&#39;: true, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;&#39;experiences&#39;:[ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;{</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;name&#39;:&#39;outOfTheBox&#39;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;weight&#39;:8, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;isControl&#39;:true &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;}, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;name&#39;:&#39;tosCheckbox&#39;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;weight&#39;:1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;}, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;name&#39;:&#39;tos&amp;mailCheckbox&#39;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;weight&#39;:1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;], &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;&#39;onStates&#39;:[ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;stateRef&#39;:&#39;newOwner&#39;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;variants&#39;:[ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;experienceRef&#39;: &#39;tosCheckbox&#39;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;parameters&#39;: {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;path&#39;:&#39;/owners/new/variant/newOwnerTest.tosCheckbox&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;experienceRef&#39;: &#39;tos&amp;mailCheckbox&#39;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;parameters&#39;: {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;path&#39;:&#39;/owners/new/variant/newOwnerTest.tosAndMailCheckbox&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;},</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;stateRef&#39;:&#39;ownerDetail&#39;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;isNonvariant&#39;: true</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp;] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">}</span></p></td></tr></tbody></table><p class="c3"><span>Listing 1. Test Schema for the Pet Clinic sample application.</span></p><p class="c3"><span>The exact meaning of this listing is considered in detail in</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1B0Amlpqys9u7atVhKjCj29_U5m49gGauNJijjFZXUIc/edit%23heading%3Dh.laouk2eh4sjq&amp;sa=D&amp;usg=AFQjCNHPRSEh5qHSLpStVBD4IxI0YaDUig">&nbsp;Section 3 Experiment Description Model (XDM)</a></span><span>&nbsp;and is not important for now,&mdash; the point is to illustrate the kinds of things that go into the test schema:</span></p><ol class="c2 lst-kix_r73b7zc4zkgc-0 start" start="1"><li class="c3 c15"><span>The list of states known to Variant. In this case Variant knows about 2 states: newOwner and ownerDetail.</span></li><li class="c3 c15"><span>The list of experiments (tests) instrumented on these states. In this example there&rsquo;s only one experiment called NewOwnerTest. It has three experiences, one of which is control and two others are variant experiences, which correspond to two different updates to the page: the tosCheckbox experience adds a Terms Of Service acceptance checkbox to the page, and the tos&amp;MailCheckbox experience also adds an email opt-in checkboxes. The user will be directed to either one of these three experiences randomly, based on the experience weights: the control experience will get 80% of the traffic, while the two variants will get 10% each.</span></li><li class="c3 c15"><span>The NewOwnerTest is instrumented on two states: newOwner and ownerDetail. One of these states is variant and the other is invariant. The state newOwner is variant because it has two variants, one for each variant experience. And the state ownerDetail is invariant because it does not have variants, which is to say that the user will see the same ownerDetail page regardless of the experience. The reason we want ownerDetail page in the test is to have Varaint container log state served event for it so that at analysis time we&rsquo;ll know if user ever reached it.</span></li></ol><p class="c3"><span>This schema definition is be passed to the Variant container for parsing and deployment at any time.</span></p><h3 class="c3 c10"><a name="h.jt8aybn9wm4"></a><span>2.1.2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Experiment Execution</span></h3><p class="c3"><span>At run time, the Variant container has the following three responsibilities:</span></p><ul class="c2 lst-kix_78p0s41mdsc0-0 start"><li class="c3 c15"><span>Experience Targeting</span></li></ul><p class="c3"><span>Variant handles the decision what test experience to present to a user. Even in the simple case of a single test, this decision is not straightforward: Variant must consider user&rsquo;s qualification for the test (application designer may supply qualification criteria) as well as whether this user&rsquo;s recent browsing history: test designer may want to ensure that a user always sees the same experiences. The complexity of this decision grows dramatically for concurrent tests.</span></p><ul class="c2 lst-kix_yq0yuxrm3del-0 start"><li class="c3 c15"><span>Event Logging</span></li></ul><p class="c3"><span>Variant automatically logs all state served events. User code may also log custom events by calling appropriate API methods.</span></p><ul class="c2 lst-kix_jdla6jmpsjre-0 start"><li class="c3 c15"><span>Traffic Routing</span></li></ul><p class="c3"><span>In many cases Variant container will take over the task of user traffic routing. This is a natural extension of experience targeting: from knowing what experience a user should be sent to&mdash;to actually doing the sending. To accomplish this, application programmer must 1) code the application in such a way that the control and variant experiences have distinct entry points, and 2) tell Variant container how to switch between them. &nbsp;For details, see Section (TBD).</span></p><p class="c3"><span>2.1.3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Experiment Analysis</span></p><p class="c3"><span>Experiment analysis typically involves two tasks:</span></p><ul class="c2 lst-kix_p479iv3dde4g-0 start"><li class="c3 c15"><span>Event Data Transformation</span></li></ul><p class="c3"><span>The raw event data, as generated at test execution time, cannot be directly used for statistical analysis. It must first be transformed (e.g. by using SQL) into a higher abstraction level metric data, i.e. contain values of the business metric(s) of interest. For instance, in our running example of the Pet Clinic application, each record represents a page view event, either of the newOwner page or the ownerDetail page. However, the metric of interest is the conversion rate from the former to the latter. The data analyst has to come up with a way to transform the page view events to conversion rate.</span></p><ul class="c2 lst-kix_8iu1z1ahl4hi-0 start"><li class="c3 c15"><span>Statistical Analysis</span></li></ul><p class="c3"><span>An experiment&rsquo;s ultimate goal is to 1) discover the difference between control and variant experience(s) with respect to the business metric of interest, and 2) assess its statistical significance.</span></p><p class="c3"><span>At the time of this writing, neither of these tasks are handled by Variant container.</span></p><h2 class="c3 c10"><a name="h.6wzdxofo2v3k"></a><span>2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Variant Application Program Interfaces</span></h2><p class="c3"><span>Variant can be exercised via three different APIs: Core, Platform and Web, Fig. 1:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 582.67px;"><img alt="Fig1.1.png" src="images/image02.png" style="width: 624.00px; height: 582.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>Fig.1 Core API, Platform API and Web Service API.</span></p><h3 class="c3 c10"><a name="h.8vupbvd2oqzf"></a><span>2.2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Core API</span></h3><p class="c3"><span>At the center of the Variant container is the most abstract Core API. It implements the</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1B0Amlpqys9u7atVhKjCj29_U5m49gGauNJijjFZXUIc/edit%23heading%3Dh.laouk2eh4sjq&amp;sa=D&amp;usg=AFQjCNHPRSEh5qHSLpStVBD4IxI0YaDUig">&nbsp;Variant XDM</a></span><span>&nbsp;without making any further assumptions about the operating domain of the target application. The Core API parses the experiment schema, targets user sessions to test experiences and logs events. However, knowing nothing about the application&rsquo;s technology platform, it cannot help in routing the user to the targeted experience. In other words, the application code may ask the Core API the question &ldquo;what test experience am I in?&rdquo; but it will be up to the application code to send the user to that experience.</span></p><p class="c3"><span>The Core API has very few dependencies, is very small (~120Kb) and extremely fast. Every effort has been made to minimize its overhead to the application path.</span></p><h3 class="c3 c10"><a name="h.1yq1ts4012t5"></a><span>2.2.2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Platform API</span></h3><p class="c3"><span>The Core API&rsquo;s abstract nature makes it applicable to any platform, e.g. a Java Servlet container, a Python/Jango application or a native mobile app,&mdash;but also somewhat hard to use. To adapt the Core API to a particular operating environment, it is typically wrapped into a Platform API, which simplifies many of the Core API&rsquo;s abstractions by adapting them to a particular platform. For instance, the Web API is the Platform API for the Java Servlet Web container, e.g. Tomcat. A similar API is under development for the Python/Django platform.</span></p><p class="c3"><span>The next step in domain specialization is the Platform Adapter. It is not a new API, but rather a set of reusable code components that can further aid the application programmer in connecting the Platform API to the platform&rsquo;s session routing capabilities. For instance, the Web Platform Adapter (comes with the Web API) &nbsp;is, a Servlet filter (with a couple of supporting classes) that handles all aspects of experiment instrumentation: experience targeting, event logging, and (because it knows enough about the operating domain) event traffic routing.</span></p><h3 class="c3 c10"><a name="h.b1ghrk9g7kvl"></a><span>2.2.3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Web Service API</span></h3><p class="c3"><span>The Core API and the Platform API are both compile time APIs. In cases when in-process integration is not feasible, Variant provides a RESTful wrapper of the Core API, called Variant Web Service. It closely mimics the functionality of the Core API and can be integrated with at run time by any client, such as client- or server-side JavaScript, Python or a native mobile app.</span></p><p class="c3"><span>At the time of this writing the Web Service API is still under development and is not included in Variant version 0.5.</span></p><h1 class="c3 c10"><a name="h.3r5ar76clmk"></a><span>3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Experiment Description Model (XDM)</span></h1><h2 class="c3 c10"><a name="h.zaiujcj453p2"></a><span>3.1. Introduction</span></h2><p class="c3"><span>Central to Variant&rsquo;s value proposition is its Experiment Description Model. It is a self-contained abstraction, comprising a complete set of entities, relationships between them and operations on them which are required to fully describe a set of RCEs operating over a computer application.</span></p><p class="c3"><span>An instance of XDM is called an XDM schema. It describes a particular set of experiments over a particular application. At the time of this writing, the only way to capture an XDM schema is via the JSON syntax, like in</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1B0Amlpqys9u7atVhKjCj29_U5m49gGauNJijjFZXUIc/edit%23heading%3Dh.tcl6zsrnf7oo&amp;sa=D&amp;usg=AFQjCNEKQQRJd3PWRsQuLxTw_GILeW-3lw">&nbsp;Listing 1.</a></span></p><p class="c3"><span>The two top level entities in XDM are states and tests, so any XDM schema has the following general structure:</span></p><a href="#" name="cf7031bc184f5c2cf81d64b90d7d2cc608356594"></a><a href="#" name="1"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c16" colspan="1" rowspan="1"><p class="c0"><span class="c1">{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp;&#39;states&#39;:[&lt;state-def:Object&gt;, ...],</span></p><p class="c0"><span class="c1">&nbsp;&#39;tests&#39;:[&lt;test-def:Object&gt;, ...]</span></p><p class="c0"><span class="c1">}</span></p></td></tr></tbody></table><p class="c3"><span>Listing 2. Basic structure of an XDM schema.</span></p><p class="c3"><span>Here and in the following two sections we are using the following syntax conventions:</span></p><a href="#" name="56cb869abc8877a353ba8438b71f818ae8a0eafa"></a><a href="#" name="2"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c1">&lt;name&gt;</span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c0"><span class="c1">Entity reference, i.e. a complete object whose exact semantics will be defined later.</span></p></td></tr><tr class="c7"><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c1">&lt;name&gt;:</span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c0"><span class="c1">Name reference, i.e. an arbitrary string that appears on the left side of &lsquo;:&rsquo;.</span></p></td></tr><tr class="c7"><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c1">:&lt;[name:]type[:default-value]&gt;</span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c0"><span class="c1">Value reference, i.e. something that appears on the right side of the &lsquo;:&rsquo;. name, if given, is strictly annotational. Must be of type type and, if optional, defaults to default-value. The keyword &lsquo;none&rsquo; for default value indicates that the entry is optional and has no default value.</span></p></td></tr><tr class="c7"><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c1">, ...</span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c0"><span class="c1">Comma separated list of similar entities.</span></p></td></tr><tr class="c7"><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c1">|</span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c0"><span class="c1">Separates alternative definitions.</span></p></td></tr></tbody></table><p class="c3 c5"><span></span></p><p class="c3"><span>Variant states form a set, not a graph, i.e. there are no connection relationships between states. User sessions traverse states one at a time, but Variant has no notion of which transitions are allowed.</span></p><p class="c3"><span>The states list must be declared before the tests list because, as will be evident soon, test definitions refer back to states.</span></p><p class="c3"><span>XDM keywords (strings to the left of the &lsquo;:&rsquo;) are case-insensitive. In other words, in the Listing 1.2. above &lsquo;States&rsquo; or &lsquo;Tests&rsquo; would also have worked. However, the value strings, i.e. those that appear to the right of the &lsquo;:&rsquo; are case sensitive.</span></p><h2 class="c3 c10"><a name="h.43fj9zmjyg1c"></a><span>3.2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;States</span></h2><h3 class="c3 c10"><a name="h.bcnevhls3p1n"></a><span>3.2.1. XDM Definition Of State</span></h3><p class="c3"><span>States represent those application states in which it &ldquo;pauses&rdquo; and prompts the user for input. In a typical Web application, states cleanly map to Web pages; in the case of a phone call center application, a state is a phone menu.</span></p><p class="c3"><span>States are completely opaque to XDM&mdash;the only two things XDM expects of a state is a name and , optionally, a list of properties. The name is an arbitrary string and a property, if present, is a name-value pair, where both the name and the value are also simple strings.</span></p><a href="#" name="f73876f6bda6867f9af7c190de05fe330fa1eecd"></a><a href="#" name="3"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c16" colspan="1" rowspan="1"><p class="c0"><span class="c1">&lt;state-def&gt; :=</span></p><p class="c0"><span class="c1">&nbsp;{ &nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;name&#39;:&lt;state-name:String&gt;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;parameters&#39;:&lt;parameters-def:none&gt;</span></p><p class="c0"><span class="c1">&nbsp;}</span></p></td></tr></tbody></table><p class="c3"><span>Listing 3. The XDM definition of a state.</span></p><p class="c3"><span>Where parameters-def is a list of arbitrary key-value pairs:</span></p><a href="#" name="cdbec6ad33c15994ac9482fd02512b056ba5cc86"></a><a href="#" name="4"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c16" colspan="1" rowspan="1"><p class="c0"><span class="c1">&lt;parameters-def&gt; :=</span></p><p class="c0"><span class="c1">&nbsp;{ &nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;&lt;param-name&gt;&#39;:&lt;param-value:String&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;, ...</span></p><p class="c0"><span class="c1">&nbsp;}</span></p></td></tr></tbody></table><p class="c3"><span>Listing 4. XDM definition of the parameters list.</span></p><h3 class="c3 c10"><a name="h.xpyxg67xatf6"></a><span>3.2.2. State Parameters</span></h3><p class="c3"><span>One of XDM&rsquo;s principal goals is separation of test instrumentation from experience implementation. In other words, experiment designer should not need to know anything about how the application developer implemented the experiences to be tested, and, conversely, the application developer shouldn&rsquo;t have to worry about the details of the experiment instrumentation.</span></p><p class="c3"><span>The test designer uses state parameters to attach application state to an XDM state. These parameters have no meaning to XDM, but will be meaningful to code external to it. Test designer has complete discretion over the names and the values of these parameters. The keys are case insensitive, in keeping with XDM&rsquo;s general approach that property names are case insensitive. Parameter values are arbitrary atomic strings whose values are never inspected by XDM.</span></p><p class="c3"><span>At runtime, a user session traverses an experience by way of consecutive state transitions. The applicaiton reaches a state, prompts user for input and pauses. User keys in some data, hits enter and the application is off to a state transition. In the most common case of a Web application, a state is a Web page and a state request happens when the browser requests that page by its resource URL. &nbsp;</span></p><p class="c3"><span>User session does not know whether the state it is requesting is instrumented by an experiment or not, but Variant does. If it is not, the user session sees exactly what it asked for, but if it is, then Variant resolves the state request by finding a suitable state variant. This may be the base (control) state, as declared in the states list, or it may be a variant of that state that corresponds to some test cell.</span></p><p class="c3"><span>State variants are defined inside the test definition, introduced in the next section. They also contain state parameters, just like the ones defined by the base state. Whenever state resolution results in a variant, variant parameters override the like-named base parameters.</span></p><p class="c3"><span>Let&rsquo;s illustrate this with our running example of the Pet Clinic Web application. We repeat the relevant fragments of its XDM schema here:</span></p><a href="#" name="fde5d416bc5f6e569bbcf813c7dcaf21adf52a08"></a><a href="#" name="5"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c16" colspan="1" rowspan="1"><p class="c0"><span class="c1">{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp;&#39;states&#39;:[ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;{ &nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;&#39;name&#39;:&#39;newOwner&#39;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;&#39;parameters&#39;: {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;&#39;path&#39;:&#39;/petclinic/owners/new&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;}, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;... &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp;], &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp;&#39;tests&#39;:[ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;&#39;name&#39;:&#39;NewOwnerTest&#39;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;&#39;experiences&#39;:[ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;{</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;name&#39;:&#39;outOfTheBox&#39;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;weight&#39;:8, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;isControl&#39;:true &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;}, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;name&#39;:&#39;tosCheckbox&#39;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;weight&#39;:1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;}, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;name&#39;:&#39;tos&amp;mailCheckbox&#39;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;weight&#39;:1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;], &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;&#39;onStates&#39;:[ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;stateRef&#39;:&#39;newOwner&#39;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;variants&#39;:[ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;experienceRef&#39;: &#39;tosCheckbox&#39;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;parameters&#39;: {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;path&#39;:&#39;/owners/new/variant/newOwnerTest.tosCheckbox&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;experienceRef&#39;: &#39;tos&amp;mailCheckbox&#39;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;parameters&#39;: {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;path&#39;:&#39;/owners/new/variant/newOwnerTest.tosAndMailCheckbox&#39;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;},</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;...</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp;] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">}</span></p></td></tr></tbody></table><p class="c3"><span>Listing 5. Fragment of the Pet Clinic schema.</span></p><p class="c3"><span>The base definition for the state newOwner contains a single state parameter &lsquo;path&rsquo;. This state represents the New Owner page and the test designer added to it the page&rsquo;s resource URL as the &lsquo;path&rsquo; resource parameter. Application code now can intercept the HTTP request to this URL and ask Variant to resolve the state.</span></p><p class="c3"><span>In this simple case, the test matrix consists only of three cells that correspond to the three experiences possible on this page: outOfTheBox (control), tosCheckbox and tos&amp;MailCheckbox. If Variant resolves the experience to control, the state&rsquo;s base property value for &lsquo;path&rsquo; remains unchanged and the application code knows to simply let the intercepted HTTP request to go right through. However, if Variant resolves the state request to either of the two variants, the value of the &lsquo;path&rsquo; parameter is overridden with what is declared by the variant. In this case, the application knows to forward to this new URL and the user sees the variant experience the test designer meant for him to see.</span></p><h2 class="c3 c10"><a name="h.65r9vbxosf6s"></a><span>3.3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tests</span></h2><h3 class="c3 c10"><a name="h.ohkzn48owf2v"></a><span>3.3.1. Concurrent Tests</span></h3><p class="c3"><span>Before we can take up the complete XDM definition of a test, we have to consider the topic of test concurrence. If two tests have no states in common, they are called serial. Serial tests never affect any states at the same time, and hence have no effect on each other. Their concurrent execution is equivalent to serial execution.</span></p><p class="c3"><span>If two tests share states, they are called concurrent. When a user session requests a state that is shared between two (or more) tests, Variant may target it to one of many possible experiences. Let&rsquo;s consider two concurrent tests T1 with a control experience Cand two variant experiences X1 and Y1, and T2 with a control experience C and one variant experience X2:</span></p><p class="c3"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 354.67px; height: 274.67px;"><img alt="Test Matrix.png" src="images/image01.png" style="width: 354.67px; height: 274.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>Fig. 2. Complete variant matrix for two concurrent tests has two areas: disjoint and covariant.</span></p><p class="c3"><span>First, let&rsquo;s consider pseudo-serial execution, i.e. run T1 for some time, then turn it off and run T2. To support T1by itself, the application developers would need to write code that implements the two variant experiences X1 and Y1. Similarly, to support T2in isolation, application developers would only need to implement X2. These three variant experiences occupy the peripheral portion of the variant matrix in Fig. 2., are shaded in light gray.</span></p><p class="c3"><span>If we want to run the two tests at the same time (e.g. to save time, as it may take weeks for each of them to reach statistical significance) we must consider the two remaining &ldquo;hybrid&rdquo; experiences, shaded in dark gray: the case when a user is targeted to variants in both tests.</span></p><p class="c3"><span>Variant XDM gives the test developer the flexibility to set the &ldquo;isolation level&rdquo; (to borrow a term from the database theory) to disjoint (pseudo-serial) or covariant (hybrid). When two concurrent tests can be targeted independently, including their hybrid variants, they are called covariant. Otherwise, if two concurrent tests can only be targeted to own variants, they are called disjoint.</span></p><p class="c3"><span>By default, all concurrent tests in Variant are disjoint, i.e. test designer does not need to implement the hybrid variants. This is a particularly useful feature when there are more than two concurrent tests and they share multiple states&mdash;the number hybrid tests grows exponentially with concurrency.</span></p><p class="c3"><span>However, XDM provides complete set of abstractions to support covariantly concurrent tests of arbitrary degree of concurrency, when a test designer needs it. Covariance relationship between tests is pairwise: if tests &nbsp;T1, T2 and T3 are concurrent, T1may be disjoint with T2but covariant with T3. A test cannot be covariant with itself.</span></p><h3 class="c3 c10"><a name="h.e0sfrg46hw8h"></a><span>3.3.2. XDM Definition Of a Test</span></h3><p class="c3"><span>A test is an experiment instrumented over a set of states. It has exactly one control experience&mdash;the one Variant assumes will be mapped to the current code path,&mdash;and at least one variant experience which represents the new code path(s) under test.</span></p><a href="#" name="3d4c26219963a6fb81c3ff00f8f3aba5bdc383ce"></a><a href="#" name="6"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c16" colspan="1" rowspan="1"><p class="c0"><span class="c1">&lt;test-def&gt; :=</span></p><p class="c0"><span class="c1">&nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;name&#39;:&#39;&lt;test-name:String&gt;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;isOn&#39;: &lt;Boolean:true&gt;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;covariantTestRefs&#39;: [&lt;test-name:String&gt;, ...],</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;experiences&#39;:[&lt;experience-def&gt;, ...],</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;onStates&#39;:[&lt;on-state-def&gt;, ...] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp;}</span></p></td></tr></tbody></table><p class="c3"><span>Listing 6. State definition in XDM</span></p><p class="c3"><span>test-name is the name of this test. It can be an arbitrary string and is, as any value, case sensitive. It may contain any characters. Follow JSON&rsquo;s escaping rules if you want to use characters that are special to JSON syntax.</span></p><p class="c3"><span>&lsquo;isOn&rsquo; indicates whether the test is on and it is true by default. If set to false, the test will be parsed, but not executed. &nbsp;More precisely;</span></p><ul class="c2 lst-kix_qvaidrs1a0z1-0 start"><li class="c3 c15"><span>A user traversing this test will always see control experience. If a user already has an entry for this test in his targeting persistor, it will be ignored, but not discarded. Otherwise the test will not be targeted.</span></li><li class="c3 c15"><span>No state served events will be logged on behalf of this test.</span></li></ul><p class="c3"><span>&lsquo;covariantTestRefs&rsquo; is a list of tests covariantly concurrent with this test. Each test on this list is a back reference, i.e. must have already been defined. For each test on this list, XDM will expect a declaration of the hybrid experience variants that implement both own and the referenced test&rsquo;s variant experiences. These declarations are part of the on-state-def and are explained the next section.</span></p><p class="c3"><span>&lsquo;experiences&rsquo; is a list of experience definitions:</span></p><a href="#" name="a9522e7fe63d347d506ed12ff4db90cb7015871c"></a><a href="#" name="7"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c16" colspan="1" rowspan="1"><p class="c0"><span class="c1">experience-def :=</span></p><p class="c0"><span class="c1">&nbsp;{</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;name&#39;:&lt;experience-name:String&gt;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;weight&#39;:&lt;Number:none&gt;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;isControl&#39;:&lt;Boolean:false&gt;</span></p><p class="c0"><span class="c1">&nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td></tr></tbody></table><p class="c3"><span>Listing 7. Experience definition in XDM</span></p><p class="c3"><span>experience-name is the name of this experience. It can be an arbitrary case sensitive string. It may contain any characters. Follow JSON&rsquo;s escaping rules if you want to use characters that are special to JSON syntax.</span></p><p class="c3"><span>&lsquo;weight&rsquo; is a numeric value of the probability weight. If present, and the programmer supplied no custom experience targeter, user sessions will be targeted to this experience randomly with probability equal to this value divided by the sum of all experiences&rsquo; weights. Ignored (and may be omitted) if the test designer supplied a custom experience targeter for this test. If omitted and no experience targeter found, a runtime exception will be thrown.</span></p><p class="c3"><span>&lsquo;isControl&rsquo; indicates whether this experience is the control experience for this test. Exactly one experience of any test must be marked as control. Optional, defaults to false.</span></p><h3 class="c3 c10"><a name="h.osac1rjp32my"></a><span>3.3.3. The onStates Property</span></h3><p class="c3"><span>The onStates property connects tests with the states on which they are instrumented. It is a list with as many elements in the onStates list, as there are states in this test. Each element defines the instrumentation of this test on a particular state:</span></p><a href="#" name="67f5a52e146dc83b0941bcbb9c1e90b656b941aa"></a><a href="#" name="8"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c16" colspan="1" rowspan="1"><p class="c0"><span class="c1">on-state-def :=</span></p><p class="c0"><span class="c1">&nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;stateRef&#39;:&lt;state-name:String&gt;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&lsquo;isNonvariant&rsquo;:&lt;Boolean:false&gt;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;variants&#39;:[&lt;on-state-variant-def&gt;,...]</span></p><p class="c0"><span class="c1">&nbsp;}</span></p></td></tr></tbody></table><p class="c3"><span>Listing 8. XDM definition of an onStates property element.</span></p><p class="c3"><span>&lsquo;stateRef&rsquo; is a backreference to a state that&rsquo;s already been defined in the</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1B0Amlpqys9u7atVhKjCj29_U5m49gGauNJijjFZXUIc/edit%23heading%3Dh.g1d5y6lmobza&amp;sa=D&amp;usg=AFQjCNGosq2WjnqcYcxO89z2jYsMjNDX2Q">&nbsp;&lsquo;states&rsquo; property</a></span><span>. This is the state whose instrumentation by this test is described by the rest of this element.</span></p><p class="c3"><span>&lsquo;varaints&rsquo; property is a list of state variants, which further define this test/state instrumentation. If this state is not shared by any other tests, each element of this list corresponds to this test&rsquo;s own variant experience. If this state is also instrumented by an already defined test then we have the case of concurrent tests. The test developer may do one of two things:</span></p><ul class="c2 lst-kix_ms5rjb6ez0rl-0 start"><li class="c3 c15"><span>Only define this test&rsquo;s own variants. This will indicate to Variant that these two concurrent tests are to be treated as disjoint, i.e. only one of them can be in a variant experience at a time.</span></li><li class="c3 c15"><span>Add the other test to this test&rsquo;s covariantTestRefs list at the test level. This will tell XDM to expect a state variant definition not only for this test&rsquo;s own experiences but also for all the hybrid ones that implement all permutations of the two tests variant experiences.</span></li></ul><p class="c3"><span>Here&rsquo;s the exact definition:</span></p><a href="#" name="0b2052130bb6529d0d1845bb1c72e2b8fef7325c"></a><a href="#" name="9"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c16" colspan="1" rowspan="1"><p class="c0"><span class="c1">on-state-variant-def :=</span></p><p class="c0"><span class="c1">&nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;experienceRef&#39;:&lt;local-experience-name:String&gt;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;parameters&#39;:&lt;parameters-def&gt;</span></p><p class="c0"><span class="c1">&nbsp;}</span></p><p class="c0 c5"><span class="c1"></span></p><p class="c0"><span class="c1">| &nbsp;</span></p><p class="c0"><span class="c1">&nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;experienceRef&#39;:&lt;local-experience-name:String&gt;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;covariantExperienceRefs&#39;: [ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;&#39;testRef&#39;:&lt;covariant-test-name:String&gt;,</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;&#39;experienceRef&#39;:&lt;covariant-experience-name:String&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;}</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp;, ...</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;], &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;parameters&#39;:&lt;parameters-def&gt;</span></p><p class="c0"><span class="c1">&nbsp;}</span></p></td></tr></tbody></table><p class="c3"><span>Listing 9. onState variant definition in XDM.</span></p><p class="c3"><span>The first form of corresponds to either the serial case or the disjointly concurrent case, when we only need to define this test&rsquo;s own variants. The second form covers the covariantly concurrent case where, in addition to this test&rsquo;s own variants, we also have to supply variant definitions for each permutation of this and the covariant variant experiences.</span></p><p class="c3"><span>&lsquo;parameters&rsquo; property defines a list of state parameters that will override the base parameters declared at the state level. See</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1B0Amlpqys9u7atVhKjCj29_U5m49gGauNJijjFZXUIc/edit%23heading%3Dh.q6yt3ibk08h2&amp;sa=D&amp;usg=AFQjCNEAgPm_kQOigHouskVuCeRcG2bmaw">&nbsp;Section 3.2.2.</a></span><span>&nbsp;for details on parameter override semantics.</span></p><p class="c3"><span>&lsquo;isNonvariant&rsquo; is a boolean property that indicates whether this test has a variant definition for the referenced state. The default is true, which is the case in most cases, and this property may be omitted. However, in some instances it is advantageous to include in a test states that do not have experience specific variants. In such cases, user sessions will see the control version of this page regardless of the experience, but Variant will log the state served event consistent with the targeted experience.</span></p><p class="c3"><span>To illustrate, let&rsquo;s use our running example of the Pet Clinic XDM schema. There, the ownerDetail state was declared non-variant because the experiment only varied the newOwner state, but since the business metric we were after is the next page conversion rate, we needed to include the next page, ownerDetail, in the test and have Variant log state served events for it too.</span></p><h1 class="c3 c10"><a name="h.iaq627kivytd"></a><span>4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Variant Core API</span></h1><h2 class="c3 c10"><a name="h.wwgjg34qax56"></a><span>4.1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Variant Container Lifecycle</span></h2><p class="c3"><span>The Core API is the most abstract of Variant application program interfaces. It is a strict implementation of the Variant Experiment Description Model (XDM), without any assumptions about the technology stack of the target application. At this time, it is only available for Java. Application programs integrate with the Core API by including the variant-core-&lt;version&gt;.jar file.</span></p><p class="c3"><span>Variant&rsquo;s runtime model is that a user session traverses an experience by way of consecutive state requests. In the most common case of a Web application, a state is a Web page and a state request refers to an HTTP request for page by its resource URL.</span></p><p class="c3"><span>The Core API is stateful, i.e. its methods must be invoked in a certain order, Fig 3. :</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 176.00px;"><img alt="Core API State Machine.png" src="images/image00.png" style="width: 624.00px; height: 176.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>Fig. 3. Core API states.</span></p><p class="c3"><span>Upon application startup, the API is in cold state: the only method it will accept is bootstrap(), which allocates Variant container&rsquo;s memory data structures. There&rsquo;s a number of system properties that the application programmer may pass to the bootstrap process, e.g. targeting.persister.idle.days.to.live &mdash; the number of days during which previous experience targeting is honored. For more, see</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1B0Amlpqys9u7atVhKjCj29_U5m49gGauNJijjFZXUIc/edit%23heading%3Dh.4q2l7hramwge&amp;sa=D&amp;usg=AFQjCNEzbwSsughZeOAU3RjulsyE6ZR9_Q">&nbsp;Section 4.5. Core API Configuration</a></span><span>.</span></p><p class="c3"><span>A bootstrapped Variant container still doesn&rsquo;t know anything about the experiments it will be asked to run. This is accomplished by calling one of the parseSchema() methods. If the method succeeds and a schema has been deployed to the Variant container, the API is ready for session scoped calls.</span></p><h2 class="c3 c10"><a name="h.if7tluykzfj8"></a><span>4.2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Variant Session Lifecycle</span></h2><p class="c3"><span>The design of the Core API assumes that the target application is an interactive one, and that its general design pattern is the event loop:</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 546.67px; height: 570.67px;"><img alt="InputLoop.png" src="images/image03.png" style="width: 546.67px; height: 570.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span>Fig 4. The input loop pattern of a target application.</span></p><p class="c3"><span>The application presents a user with a prompt (e.g. a Web page or a phone menu) and &ldquo;blocks&rdquo;, waiting for user input. When user input is received, the application determines the next state to which to pass it for processing. E.g, in the case of the Web application this correspond to an HTTP request to the server. This next state then processes the request and returns to the user with the next input prompt.</span></p><p class="c3"><span>In the deterministic case with no experiments, the next state request fetches exactly the state that was requested. Variant&rsquo;s runtime injects experiment into this basic pattern is by overlaying additional logic at the point of the next state request: it now may resolve that request to one of a number of states. It may end up being the original state requested (the case of control) or one of the variant states, defined in the currently deployed state schema. These variant states directly map to the test experiences instrumented on the requested state.</span></p><p class="c3"><span>The semantics of this decision are quite complex: Variant has to consider a number of issues:</span></p><ul class="c2 lst-kix_z7g10cw8i077-0 start"><li class="c3 c15"><span>The entire variance matrix instrumented on the requested page.</span></li><li class="c3 c15"><span>The experiences previously shown to this user.</span></li><li class="c3 c15"><span>Custom qualification rules.</span></li><li class="c3 c15"><span>Custom targeting rules.</span></li><li class="c3 c15"><span>Probability weights.</span></li></ul><p class="c3"><span>All of this is hidden behind the newStateRequest() method, which the application code calls to resolve a state. It returns an instance of the VariantStateRequest object which application can inspect for the resolved state, as well as other useful info.</span></p><p class="c3"><span>Once the application knows what actual experience to go to, it sends the user into that experience and proceeds about its own business. When it is about to return to the user with the next interactive prompt, the application is responsible for committing the VariantStateRequest object it obtained from the Variant container. This will record all the state served events for the state we just visited.</span></p><h2 class="c3 c10"><a name="h.iev9bur40tea"></a><span>4.3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Typical Core API Code Path</span></h2><p class="c3"><span>Here&rsquo;s how a typical target application will use Variant Core API.</span></p><a href="#" name="84edf019b7f5af23628d75cf94826cad3d112ca6"></a><a href="#" name="10"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c16" colspan="1" rowspan="1"><p class="c0"><span class="c1">Variant variant = Variant.Factory.getInstance(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// 1</span></p><p class="c0"><span class="c1">variant.bootstrap(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// 2</span></p><p class="c0"><span class="c1">ParserResponse response = engine.parseSchema(&quot;/variant/schema.json&quot;); &nbsp; &nbsp; &nbsp; // 3</span></p><p class="c0 c5"><span class="c1"></span></p><p class="c0"><span class="c1">if (response.highestMessageSeverity().greaterOrEqualThan(Severity.ERROR)) { // 5</span></p><p class="c0"><span class="c1">&nbsp;LOG.error(&quot;Unable to parse Variant test schema due to following error(s):&quot;);</span></p><p class="c0"><span class="c1">&nbsp;for (ParserMessage msg: resp.getMessages()) {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;LOG.error(msg.toString());</span></p><p class="c0"><span class="c1">&nbsp;}</span></p><p class="c0"><span class="c1">} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // 10</span></p><p class="c0 c5"><span class="c1"></span></p><p class="c0"><span class="c1">// Application continues to initialize...</span></p><p class="c0 c5"><span class="c1"></span></p><p class="c0"><span class="c1">// Probably on a different thread:</span></p><p class="c0"><span class="c1">VariantSession session = getSession(sidPersisterUserData); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // 15</span></p><p class="c0"><span class="c1">VariantStateRequest variantRequest = &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // 16</span></p><p class="c0"><span class="c1">&nbsp;newStateRequest(session, state, targetingPersisterUserData);</span></p><p class="c0 c5"><span class="c1"></span></p><p class="c0"><span class="c1">// Application does something...</span></p><p class="c0 c5"><span class="c1"></span></p><p class="c0"><span class="c1">variantRequest.commit(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // 21</span></p><p class="c0 c5"><span class="c1"></span></p><p class="c0"><span class="c1">// Application does something...</span></p></td></tr></tbody></table><p class="c3"><span>Listing 10. Typical Core API code path.</span></p><p class="c3"><span>We start with obtaining the instance of the Variant container on line (1). There&rsquo;s only one of those per JVM, so it&rsquo;s okay for the caller to hold on to the Variant object and reuse it. The next step is to bootstrap the Variant container, line (2). In this case we are not passing any configuration properties to the boostrap() call, relying on their default values. See</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1B0Amlpqys9u7atVhKjCj29_U5m49gGauNJijjFZXUIc/edit%23heading%3Dh.4q2l7hramwge&amp;sa=D&amp;usg=AFQjCNEzbwSsughZeOAU3RjulsyE6ZR9_Q">&nbsp;Section 4.5. Core API Configuration</a></span><span>&nbsp;for more on configuring the container.</span></p><p class="c3"><span>Next, on line (3) we parse and deploy the test schema from a resource file /variant/schema.json. (There are other forms in this method that take an OS file or an InputStream.) Before proceeding with the text execution, we should check if Variant encountered any errors parsing the schema. We do this on lines (5-10).</span></p><p class="c3"><span>At this point Variant container has been initialized and is ready to manage experiments. Each time the application needs to resolve a state, it first asks Variant container to resolve that state, line (16). Note that the newStateRequest() takes a VariantSession object as its argument. Application code can always obtain its session from Variant container by calling getSession() method, line (15).</span></p><p class="c3"><span>VariantStateRequest object contains the state resolution info, i.e. the name of the base state and the set of resolved parameters. Application code uses this to proceed with its own business of visiting that state. At the end, it must commit the VariantStateRequest object, line (21).</span></p><p class="c3"><span>Note that if your target application is a Web application, you should use the</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1B0Amlpqys9u7atVhKjCj29_U5m49gGauNJijjFZXUIc/edit%23heading%3Dh.sgkogbh2with&amp;sa=D&amp;usg=AFQjCNHl1wp_-1Lr-pSCvgP_uqd8lAIctQ">&nbsp;Web API</a></span><span>, which hides a lot of abstract complexities of the Core API and replaces them with simple familiar J2E notions.</span></p><h2 class="c3 c10"><a name="h.h8kw1onqkhhp"></a><span>4.4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Accessing Test Schema At Runtime</span></h2><p class="c3"><span>The target application has complete access to the currently deployed schema via the getSchema() method which returns the Schema object with further methods the application programmer may use to introspect into any of the currently defined states or tests. Refer to the Javadocs for further information.</span></p><p class="c3"><span>There is no programmatic way of altering any of the currently deployed tests, or of building new ones at runtime.</span></p><h2 class="c3 c10"><a name="h.pznibhjw4e5q"></a><span>4.5. The Core API Configuration</span></h2><p class="c3"><span>The Variant container is configured with a set of application properties. Typically, they will be packaged into properties files and passed to the container at during bootstrap, but may also be overridden from the JVM command line.</span></p><p class="c3"><span>The bootstrap() method takes an arbitrary number of String arguments. &nbsp;If supplied, each argument is understood as a Java class path resource name. Each resource is expected to contain a set of application properties, as specified by Java&rsquo;s &nbsp;</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.oracle.com/javase/8/docs/api/java/util/Properties.html%23load-java.io.Reader-&amp;sa=D&amp;usg=AFQjCNGAKfqDM24tKFhZy_o4GWNcNr8i4A">Properties.load()</a></span><span>&nbsp;method.</span></p><p class="c3"><span>When, at runtime, the container looks for the value of a particular property key, these files are scanned left to right and the last value found takes precedence. If a value wasn&rsquo;t found in any of the supplied files, or if no files were supplied, the default value is used, as defiled in the /variant-default.props file found inside the variant-core-&lt;version&gt;.jar file.</span></p><p class="c3"><span>Property values, as supplied to the bootstrap() method, may be overridden from the JVM command line as follows:</span></p><ul class="c2 lst-kix_b7ed74530dzt-0 start"><li class="c3 c15"><span>You may place the /variant.props file anywhere on the classpath. The Core API will always attempt to look for it, and, if found, the values therein override those from the files passed to the bootstrap() method.</span></li><li class="c3 c15"><span>Pass the &ndash;Dvariant.props.resource=... command line parameter to the JVM. The supplied value is understood to be a classpath resource name, which must exist.</span></li><li class="c3 c15"><span>Pass the &ndash;Dvariant.props.file=... command line parameter to the JVM. The supplied value is understood to be an OS file, which must exist. It is an error to supply both &#8209;Dvariant.props.resource and &#8209;Dvariant.props.resource.</span></li></ul><h2 class="c3 c10"><a name="h.iplyy4j6gek5"></a><span>4.4. Extending Core API With Flashpoints</span></h2><p class="c3"><span>Flashpoints provide a consistent way of extending the functionality of the Core API with custom code. A flashpoint is a predefined point in the lifecycle of the Core API to which the application programmer may attach a callback method to be invoked whenever the container code reaches it.</span></p><p class="c3"><span>To attach a custom callback method to a flashpoint, application programmer must</span></p><ul class="c2 lst-kix_wu1e0tf9ypzh-0 start"><li class="c3 c15"><span>Write a listener class that implements the FlashpointListener interface. &nbsp;The post() method of this class is the callback method that the Variant container will call when the flashpoint of interest is reached.</span></li><li class="c3 c15"><span>Add an instance of this class to the container by passing it to the addFlashpointListener().</span></li></ul><p class="c3"><span>The following table lists all suppoted flashpoints.</span></p><a href="#" name="7e22dadc09b8e5fd4326b4ca7517459b38e0a5ef"></a><a href="#" name="11"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c1">Flashpoint</span></p></td><td class="c11 c18" colspan="1" rowspan="1"><p class="c0"><span class="c1">Description</span></p></td></tr><tr class="c7"><td class="c17" colspan="1" rowspan="1"><p class="c0"><span class="c1">StateParsedFlashpoint</span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c0"><span class="c1">Reached whenever the schema parser completes parsing of a state. Use this flashpoint to enforce domain semantics that is external to XDM.</span></p></td></tr><tr class="c7"><td class="c17" colspan="1" rowspan="1"><p class="c0"><span class="c1">TestParsedFlashpoint</span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c0"><span class="c1">Reached whenever the schema parser completes parsing of a test. Use this flashpoint to enforce domain semantics that is external to XDM.</span></p></td></tr><tr class="c7"><td class="c17" colspan="1" rowspan="1"><p class="c0"><span class="c1">TestQualificationFlashpoint</span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c0"><span class="c1">Reached whenever the experience targeter is about to randomly target a user session. If no listeners are supplied, the Variant container treats all user sessions as qualifying. The callback function may change this semantics by calling the setQualified() method.</span></p></td></tr></tbody></table><h1 class="c3 c10"><a name="h.n8i6f8aea7ic"></a><span>5. Variant Web API</span></h1><h2 class="c3 c10"><a name="h.n6nxrch7zyf5"></a><span>5.1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Introduction</span></h2><p class="c3"><span>Variant Web API is the platform API suitable for Web applications written on top of the Java Servlet API. It is a facade API around the</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1B0Amlpqys9u7atVhKjCj29_U5m49gGauNJijjFZXUIc/edit%23heading%3Dh.8hbfmdiuuxtu&amp;sa=D&amp;usg=AFQjCNHTNTuFyD23g0qPmXNRf8Zk4FCwFg">&nbsp;Core API</a></span><span>&nbsp;with the advantage of hiding much of the Core API&rsquo;s complexities behind a new set of methods that operate on familiar Servlet API object like HttpServletRequest and HttpServletResponse.</span></p><p class="c3"><span>Web API interprets states as Web pages whose resource URLs must be passed in the path state parameter. At runtime, Variant is able to use this value to match the URL of the incoming HTTP request to an instrumented page.</span></p><p class="c3"><span>The Web API also comes with a set of auxiliary classes collectively known as the Web Platform Adapter. These are higher level components which, in most cases, can and should be used to save the application developer time and complexity of coding directly to the Web API. See</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1B0Amlpqys9u7atVhKjCj29_U5m49gGauNJijjFZXUIc/edit%23heading%3Dh.oet9nlzcxdo&amp;sa=D&amp;usg=AFQjCNE6FRHb9Pmpwa775TJ3VY_AcgTFIA">&nbsp;Section 5.5 Web API Platform Adapter</a></span><span>&nbsp;for details.</span></p><p class="c3"><span>All of Web API source code is included in the variant-web-&lt;version&gt;.jar file.</span></p><h2 class="c3 c10"><a name="h.cz3r7bt9k9hm"></a><span>5.2. Initialization</span></h2><p class="c3"><span>To integrate with The Web API, place the variant-web-&lt;version&gt;.jar and the variant-core-&lt;version&gt;.jar files on the classpath.</span></p><p class="c3"><span>The entry point into the Variant Web API is the method com.variant.web.VariantWeb.boostrap() which initializes the Variant container. It serves as a passthrough to the</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1B0Amlpqys9u7atVhKjCj29_U5m49gGauNJijjFZXUIc/edit%23heading%3Dh.4q2l7hramwge&amp;sa=D&amp;usg=AFQjCNEzbwSsughZeOAU3RjulsyE6ZR9_Q">&nbsp;core bootstrap() method</a></span><span>.</span></p><p class="c3"><span>Once the Variant container has been bootstrapped, it is ready to parse and deploy a test schema, which is accomplished by one of the parseSchema() methods. These, too are passthroughs to the core parseSchema() methods.</span></p><h2 class="c3 c10"><a name="h.cghozjq0abp9"></a><span>5.3. Variant Session Lifecycle Methods</span></h2><p class="c3"><span>A Variant session managed by the Web API is the same session that is created and managed by the underlying Core API and it undergoes the</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1B0Amlpqys9u7atVhKjCj29_U5m49gGauNJijjFZXUIc/edit%23heading%3Dh.seacv7n6tstm&amp;sa=D&amp;usg=AFQjCNEBNqCaa8-B9WdtGqCHXJCuPVkQQA">&nbsp;same lifecycle</a></span><span>. The application code is expected to call the newStateRequest() method when an HTTP request comes for a particular page that is instrumented by Variant. This will return an instance of the VariantStateRequest class, which the application code can use to find out what test cell the current session is in. If it&rsquo;s the control cell, the user is sent to the old code path, and if it is a variant&mdash;to (one of) the new code paths. After the application is done visiting this state, it must commit the Variant request object, in order to flush all the pending state served events.</span></p><p class="c3"><span>Application code may obtain its Variant session by calling the getSession() method. However, in contrast with the Core API, it is not necessary to first obtain the session before calling the newStateRequest() method: it knows how to obtain the Variant session from the HttpServletRequest object it takes as a parameter.</span></p><h2 class="c3 c10"><a name="h.xu6l4orfcrto"></a><span>5.4.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Typical Web API Code Path</span></h2><p class="c3"><span>The typical Web API code path is presented in the listing 11 below.</span></p><a href="#" name="3f0d560e4e565f6740975bd6f0114a7d6a656350"></a><a href="#" name="12"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c16" colspan="1" rowspan="1"><p class="c0"><span class="c1">VariantWeb webApi = new VariantWeb(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(1)</span></p><p class="c0 c5"><span class="c1"></span></p><p class="c0"><span class="c1">webApi.bootstrap(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(2)</span></p><p class="c0 c5"><span class="c1"></span></p><p class="c0"><span class="c1">HttpServletRequest httpRequest = ... &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (3)</span></p><p class="c0"><span class="c1">HttpServletResponse httpResponse = ... &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (4) &nbsp; &nbsp;</span></p><p class="c0 c5"><span class="c1"></span></p><p class="c0"><span class="c1">String url = VariantWebUtils.requestUrl(httpRequest); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(5)</span></p><p class="c0"><span class="c1">State state = StateSelectorByRequestPath.select(url); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(6)</span></p><p class="c0 c5"><span class="c1"></span></p><p class="c0"><span class="c1">if (state != null) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (7)</span></p><p class="c0"><span class="c1">&nbsp;VariantStateRequest variantRequest = &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (8)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;webApi.newStateRequest(state, httpRequest);</span></p><p class="c0 c5"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp;String resolvedPath = variantRequest.getResolvedParameterMap().get(&quot;path&quot;); &nbsp;(10)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp;boolean isForwarding = !resolvedPath.equals(state.getParameter(&quot;path&quot;)); &nbsp; &nbsp; (11)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp;if (isForwarding) { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(12)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;// We&rsquo;re in a variant. There are additional methods on the</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;// VariantStateRequest object to help figure out which one.</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;// Send user to new code.</span></p><p class="c0"><span class="c1">&nbsp;}</span></p><p class="c0"><span class="c1">&nbsp;else { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (17)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;// We&rsquo;re in control - send user to the old code.</span></p><p class="c0"><span class="c1">&nbsp;}</span></p><p class="c0 c5"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp;StateServeEvent event = variantRequest.getStateServeEvent(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (20)</span></p><p class="c0"><span class="c1">&nbsp;event.setParameter(&quot;HTTP_STATUS&quot;, httpResponse.getStatus()); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (21)</span></p><p class="c0"><span class="c1">&nbsp;webApi.commitViewRequest(variantRequest, httpResponse); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(22)</span></p><p class="c0"><span class="c1">}</span></p></td></tr></tbody></table><p class="c3"><span>Listing 11. Typical Web API code path.</span></p><p class="c3"><span>On line (1) we obtain an API handle. It may be held on to and reused indefinitely. The next step is to bootstrap the Variant container, line (2). Initialization parameters can be passed to the bootstrap() method, as explained in</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1B0Amlpqys9u7atVhKjCj29_U5m49gGauNJijjFZXUIc/edit%23heading%3Dh.flx9sxqx3nyb&amp;sa=D&amp;usg=AFQjCNHsyHqlIVhw6wqdieqahTo94EfrLw">&nbsp;Section 5.2. Initialization</a></span><span>.</span></p><p class="c3"><span>Lines (3-4) illustrate the fact that we&rsquo;re running in a Servlet container and are able to figure out the current HTTP request and response objects.</span></p><p class="c3"><span>Next, we need to figure out the Variant state that is being requested. It&rsquo;s entirely up to the application code: the Web API cannot help us with this. On lines (5-6) we make use of two Web Adapter components: on line (5) we extract the request path from the HTTP request object (a simple task&mdash;most Servlet programmers will know how to do that), and on line (6) we use the StateSelectorByRequestPath object to find the state that corresponds to this request path.</span></p><p class="c3"><span>Matching the HTTP request path to a Variant state may be as simple as comparing it with the value of the path state parameter. But in many cases, multiple different paths may map to the same state and a more sophisticated path matching scheme is required. The StateSelectorByRequestPath class implements one such scheme. It is flexible enough to probably work well for most applications and has no dependencies other than the Core API, so can be used directly. More on this in</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.google.com/document/d/1B0Amlpqys9u7atVhKjCj29_U5m49gGauNJijjFZXUIc/edit%23heading%3Dh.exxbbz7w24fk&amp;sa=D&amp;usg=AFQjCNFvpLGW9oHXbtiJaDT6WuGJKnlxvA">&nbsp;Section 5.5.4. StateSelectorByRequestPath</a></span><span>.</span></p><p class="c3"><span>The next step is to have Variant resolve the current state request, line (8). The resulting VariantStateRequest object contains all the info the application needs to figure out what test experience (or, possibly, experiences, if this state is instrumented by covariantly concurrent tests) this session is in and therefore what code path to take.</span></p><p class="c3"><span>On line (20) we add an event parameter to the pending state serve event, generated by the current state request. The application programmer may want to add this information to be able to exclude application failures from analysis. Finally, on line (22) we commit the current Variant request, which writes the pending state served event to disk.</span></p><h2 class="c3 c10"><a name="h.yn7ooeq48efy"></a><span>5.5.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Web API Platform Adapter</span></h2><p class="c3"><span>The Web API comes with a platform adapter &mdash; a set of auxiliary higher level objects that can be directly integrated into a Servlet Web application. The application programmer still has full access to the Web API, but is relieved from the tedious and error prone event loop programming. Another great advantage of the Web Adapter framework is that it handles traffic routing, provided that the application programmer&rsquo;s implementation is such that each distinct variant experience has a single entry point and this entry point is enterable as servlet resource, i.e. via a server side forward.</span></p><p class="c3"><span>Note that the sample Pet Clinic application, which comes packaged with the Web API, is instrumented via the Web Adapter and can be used as the starting point for your own development.</span></p><p class="c3"><span>The following sections introduce the key part of the Web Platform Adapter framework.</span></p><h3 class="c3 c10"><a name="h.r7bf2de8l0fp"></a><span>5.5.1. VariantFilter</span></h3><p class="c3"><span>The central component of the Web Platform Adapter is the VariantFilter class. It implements the Filter interface and installs as a servlet filter in front of the Web application. Here&rsquo;s the relevant section from the Pet Clinic deployment descriptor file:</span></p><a href="#" name="aed82064e7c9c2c5216a5ad38deecde39abbcb56"></a><a href="#" name="13"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c16" colspan="1" rowspan="1"><p class="c0"><span class="c1">&lt;!-- Variant Filter --&gt;</span></p><p class="c0"><span class="c1">&lt;filter&gt;</span></p><p class="c0"><span class="c1">&nbsp;&lt;filter-name&gt;variantFilter&lt;/filter-name&gt;</span></p><p class="c0"><span class="c1">&nbsp;&lt;filter-class&gt;com.variant.web.adapter.VariantFilter&lt;/filter-class&gt;</span></p><p class="c0"><span class="c1">&nbsp;&lt;init-param&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&lt;param-name&gt;schemaResourceName&lt;/param-name&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&lt;param-value&gt;/variant/schema.json&lt;/param-value&gt;</span></p><p class="c0"><span class="c1">&nbsp;&lt;/init-param&gt;</span></p><p class="c0"><span class="c1">&nbsp;&lt;init-param&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&lt;param-name&gt;propsResourceName&lt;/param-name&gt;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&lt;param-value&gt;/variant/variant.props&lt;/param-value&gt;</span></p><p class="c0"><span class="c1">&nbsp;&lt;/init-param&gt;</span></p><p class="c0"><span class="c1">&lt;/filter&gt;</span></p><p class="c0"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&lt;filter-mapping&gt;</span></p><p class="c0"><span class="c1">&nbsp;&lt;filter-name&gt;variantFilter&lt;/filter-name&gt;</span></p><p class="c0"><span class="c1">&nbsp;&lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span></p><p class="c0"><span class="c1">&lt;/filter-mapping&gt;</span></p></td></tr></tbody></table><p class="c3"><span>Listing 12. VariantFilter configuration.</span></p><p class="c3"><span>VaraintFilter takes two init parameters:</span></p><a href="#" name="285d5b9eaab42438bbbf62404fdfeb5035c18693"></a><a href="#" name="14"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c13" colspan="1" rowspan="1"><p class="c0"><span class="c1">Init Parameter</span></p></td><td class="c11 c18" colspan="1" rowspan="1"><p class="c0"><span class="c1">Description</span></p></td></tr><tr class="c7"><td class="c17" colspan="1" rowspan="1"><p class="c0"><span class="c1">schemaResourceName</span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c0"><span class="c1">Identifies the schema JSON file as a classloader resource.</span></p></td></tr><tr class="c7"><td class="c17" colspan="1" rowspan="1"><p class="c0"><span class="c1">propsResourceName</span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c0"><span class="c1">Identifies the application properties file as a classloader resource.</span></p></td></tr></tbody></table><p class="c3 c5"><span></span></p><h3 class="c3 c10"><a name="h.kpf52vxvggzy"></a><span>5.5.2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SessionIdTrackerHttpCookie</span></h3><p class="c3"><span>An implementation of the SessionIdTracker interface suitable for any Java Servlet application. It uses the HTTP cookie mechanism to track Variant session ID in the cookie named vrnt-ssnid, much like the Servlet container uses the JSESSIONID cookie to track the HTTP session ID.</span></p><p class="c3"><span>Even if you are not able to use VariantFilter to instrument your application, it&rsquo;s very likely that this implementation of Variant session tracking is just what you need and you should reuse it by passing its class name to the session.id.tracker.class.name application property.</span></p><h3 class="c3 c10"><a name="h.46zcmhae7w0j"></a><span>5.5.3. TargetingTrackerHttpCookie</span></h3><p class="c3"><span>An implementation of the TargetingTracker interface suitable for any Java Servlet application. It implements targeting stability via the HTTP cookie vrnt-target: Variant will save in his cookie user&rsquo;s targeted experiences, so that if he returns to the site, Variant will attempt to replay them.</span></p><p class="c3"><span>Even if you are not able to use VariantFilter to instrument your application, it&rsquo;s very likely that this implementation of targeting stability is just what you need and you should reuse it by passing this class name to the targeting.tracker.class.name application property.</span></p><h3 class="c3 c10"><a name="h.k7e3xktqa5to"></a><span>5.5.4. StateSelectorByRequestPath</span></h3><p class="c3"><span>The Web API uses the path state property to map the HTTP request to a Variant state. Although in many cases this is a matter of simple comparison of the request path to the value of the path state parameter, occasionally a more sophisticated path matching scheme is required. For instance, in the ownerDetail state definition in the Pet Clinic sample application, which we repeat below, the path parameter is not a simple string:</span></p><a href="#" name="cc1b58c02d5cbc544cfc50dbe42ae48e3ca56dbd"></a><a href="#" name="15"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c18 c21" colspan="1" rowspan="1"><p class="c0"><span class="c1">{</span></p><p class="c0"><span class="c1">&nbsp;&#39;name&#39;:&#39;ownerDetail&#39;, &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">&nbsp;&#39;parameters&#39;: {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp;&#39;path&#39;:&#39;/petclinic/owners/~\\d+/&#39;</span></p><p class="c0"><span class="c1">&nbsp;} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c0"><span class="c1">} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p></td></tr></tbody></table><p class="c3"><span>Listing 13. ownerDetail state definition</span></p><p class="c3"><span>Rather, it&rsquo;s an expression that will match many strings at run time: the &lsquo;/~\\d+/&rsquo; section stands for a regular expression that will match one or more digits between two consecutive path separators.</span></p><p class="c3"><span>The reason for this complication is that that the Pet Clinic application (as many others) uses the RESTful style resource paths: the path to the owner detail page for owner ID 1 is /petclinic/owners/1 and the path to the same page for the owner ID 2 is /petclinic/owners/2.</span></p><p class="c3"><span>The expression in Listing 13 above is interpreted by the StateSelectorByRequestPath path mather, which implements a sophisticated path matching scheme:</span></p><ul class="c2 lst-kix_r3an3irmt9is-0 start"><li class="c3 c15"><span>Symbol &lsquo;/&rsquo; always stands for the path separator. Any path must start with &lsquo;/&rsquo;.</span></li><li class="c3 c15"><span>Any sequence of symbols between two consecutive symbols &#39;/&#39; is taken to be a literal, unless the first letter of the sequence is a tilde &#39;~&#39;, in which case the string immediately following the tilde and until, but not including, the next unescaped &lsquo;/&rsquo; is considered a regular expression.</span><span class="c14"><a class="c4" href="https://www.google.com/url?q=https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html&amp;sa=D&amp;usg=AFQjCNExNa9CPLKQsKVIECowEq-Wor69Gg">&nbsp;Complete regular expression syntax</a></span><span>&nbsp;is supported.</span></li><li class="c3 c15"><span>Although symbol &lsquo;/&rsquo; does not have a special meaning in the regular expression grammar, it does for Variant: this is how Variant decides where a regular expression ends. Therefore, if &lsquo;/&rsquo; must be included in the regular expression, it must be escaped with the &lsquo;\&rsquo; symbol, like any other special character. By including &lsquo;/&rsquo; symbols in the regular expression, it is possible to match variable sections in the middle of a path.</span></li><li class="c3 c15"><span>Symbol &lsquo;//&rsquo; can be used anywhere, where &lsquo;/&rsquo; can be used, and is a shortcut for &lsquo;/~.*/&rsquo;. On other words, &lsquo;//&rsquo; will match any string. Note that &lsquo;///&rsquo; is legal but superfluous because it will be expanded to &lsquo;/~.*/~.*/&rsquo;.</span></li><li class="c3 c15"><span>The very last &lsquo;/&rsquo; of the pattern is not significant, i.e. Variant will remove it, if present, from both the pattern and the path after all &lsquo;//&rsquo; are expanded. This enables easy prefix match: &lsquo;/user//&rsquo; will match any path that starts with &lsquo;/user/&rsquo;.</span></li></ul><p class="c3"><span>Examples:</span></p><a href="#" name="5cb0585246d6f38cb2c6d6e1d42bee021dadce8e"></a><a href="#" name="16"></a><table cellpadding="0" cellspacing="0" class="c6"><tbody><tr class="c7"><td class="c12 c18" colspan="1" rowspan="1"><p class="c0"><span class="c1">Path</span></p></td><td class="c8" colspan="1" rowspan="1"><p class="c0"><span class="c1">Will Match</span></p></td><td class="c9 c18" colspan="1" rowspan="1"><p class="c0"><span class="c1">Will not match</span></p></td></tr><tr class="c7"><td class="c12" colspan="1" rowspan="1"><p class="c0"><span class="c1">/user</span></p></td><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c1">/user</span></p><p class="c0"><span class="c1">/user/</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c1">/user/new</span></p></td></tr><tr class="c7"><td class="c12" colspan="1" rowspan="1"><p class="c0"><span class="c1">/user//</span></p></td><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c1">/user</span></p><p class="c0"><span class="c1">/user/</span></p><p class="c0"><span class="c1">/user/new</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c1">/service/user/</span></p></td></tr><tr class="c7"><td class="c12" colspan="1" rowspan="1"><p class="c0"><span class="c1">/user//.html</span></p></td><td class="c20" colspan="1" rowspan="1"><p class="c0"><span class="c1">/user/new/error.html</span></p></td><td class="c9" colspan="1" rowspan="1"><p class="c0"><span class="c1">/user/error</span></p></td></tr></tbody></table><p class="c3 c5"><span></span></p><p class="c3 c5"><span></span></p></body></html>